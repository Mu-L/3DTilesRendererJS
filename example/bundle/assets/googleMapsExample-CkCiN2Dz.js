import{W as b,S,a as T,O as D,n as h}from"./three.module-BB2USAyE.js";import{G as E,e as F}from"./GLTFLoader-_VBLdhWf.js";import{D as G}from"./DRACOLoader-Db8BN0-X.js";import{g as L,t as W}from"./lil-gui.module.min-D95Toaa3.js";import{S as A}from"./stats.module--VATS4Kh.js";import{C as M}from"./CameraTransitionManager-Dj8t98oE.js";import{W as u,G as $,T as H}from"./TileCompressionPlugin-D8IJLwao.js";import{G as I}from"./GlobeControls-CLLOjRy9.js";import{G as O}from"./GoogleCloudAuthPlugin-Ccye0Neh.js";import"./TilesRenderer-BWSIOyW5.js";import"./B3DMLoader-DkbFLGRR.js";import"./readMagicBytes-jydveJgU.js";import"./LoaderBase-QLlipkOW.js";import"./PNTSLoader-Cb7x1xFL.js";import"./I3DMLoader-BBnK3G_T.js";import"./CMPTLoader-CO2F6B4Q.js";import"./GLTFExtensionLoader-Dn4yPdlw.js";import"./EnvironmentControls-BSw-XyT-.js";let m,c,i,e,o,f,g;const k=localStorage.getItem("googleApiKey")??"put-your-api-key-here",d={orthographic:!1,enableCacheDisplay:!1,enableRendererStats:!1,apiKey:k,reload:v};K();R();function v(){e&&(c.remove(e.group),e.dispose(),e=null),localStorage.setItem("googleApiKey",d.apiKey),e=new $,e.registerPlugin(new O({apiToken:d.apiKey})),e.registerPlugin(new H),e.group.rotation.x=-Math.PI/2,e.errorTarget=50;const a=new G;a.setDecoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/");const t=new E(e.manager);t.setDRACOLoader(a),e.manager.addHandler(/\.gltf$/,t),c.add(e.group),e.setResolutionFromRenderer(o.camera,i),e.setCamera(o.camera),m.setTilesRenderer(e)}function K(){i=new b({antialias:!0}),i.setClearColor(1383455),document.body.appendChild(i.domElement),c=new S,o=new M(new T(60,window.innerWidth/window.innerHeight,1,16e7),new D(-1,1,1,-1,1,16e7)),o.perspectiveCamera.position.set(48e5,257e4,1472e4),o.perspectiveCamera.lookAt(0,0,0),o.addEventListener("camera-changed",({camera:s,prevCamera:l})=>{e.deleteCamera(l),e.setCamera(s),m.setCamera(s)}),o.orthographicPositionalZoom=!1,m=new I(c,o.camera,i.domElement,null),v(),P(),window.addEventListener("resize",P,!1),window.addEventListener("hashchange",y);const a=new L;a.width=300,a.add(d,"orthographic").onChange(s=>{m.getPivotPoint(o.fixedPoint),m.updateCameraClipPlanes(o.perspectiveCamera),m.updateCameraClipPlanes(o.orthographicCamera),o.toggle()});const t=a.addFolder("Google Tiles");t.add(d,"apiKey"),t.add(d,"reload");const r=a.addFolder("Example Options");r.add(d,"enableCacheDisplay"),r.add(d,"enableRendererStats"),f=document.createElement("div"),document.getElementById("info").appendChild(f),g=new A,g.showPanel(0),document.body.appendChild(g.dom),y(),setInterval(z,100)}function P(){const{perspectiveCamera:a,orthographicCamera:t}=o,r=window.innerWidth/window.innerHeight;a.aspect=r,a.updateProjectionMatrix(),t.left=-t.top*r,t.right=-t.left,t.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio)}function z(){if(!e)return;const a=o.camera,t={},r=e.group.matrixWorld.clone().invert(),s=a.position.clone().applyMatrix4(r);u.getPositionToCartographic(s,t),t.lat*=h.RAD2DEG,t.lon*=h.RAD2DEG;const l=u.getPositionElevation(s),n=[parseFloat(t.lat.toFixed(4)),parseFloat(t.lon.toFixed(4)),l.toFixed(4)];window.history.replaceState(void 0,void 0,`#${n.join()}`)}function y(){const t=window.location.hash.replace(/^#/,"").split(/,/g).map(p=>parseFloat(p));if(t.length<2||t.findIndex(p=>Number.isNaN(p))!==-1)return;const[r,s,l=1e3]=t,n=o.camera;u.getCartographicToPosition(r*h.DEG2RAD,s*h.DEG2RAD,l,n.position),e.group.updateMatrixWorld(),n.position.applyMatrix4(e.group.matrixWorld),n.lookAt(0,0,0)}function R(){if(requestAnimationFrame(R),!e)return;m.enabled=!o.animating,m.update(),o.update();const a=o.camera;e.setResolutionFromRenderer(a,i),e.setCamera(a),a.updateMatrixWorld(),e.update(),i.render(c,a),g.update(),j()}function j(){const a=e.lruCache.itemList.length/e.lruCache.maxSize;let t="";if(d.enableCacheDisplay){t+=`Downloading: ${e.stats.downloading} Parsing: ${e.stats.parsing} Visible: ${e.visibleTiles.size}<br/>`;const n=new Set;e.traverse(C=>{const w=C.cached.scene;w&&w.traverse(x=>{x.geometry&&n.add(x.geometry)})});let p=0;n.forEach(C=>{p+=F(C)}),t+=`Cache: ${(100*a).toFixed(2)}% ~${(p/1e3/1e3).toFixed(2)}mb<br/>`}if(d.enableRendererStats){const n=i.info.memory,p=i.info.programs.length;t+=`Geometries: ${n.geometries} Textures: ${n.textures} Programs: ${p}`}f.innerHTML!==t&&(f.innerHTML=t);const r=e.group.matrixWorld.clone().invert(),s=o.camera.position.clone().applyMatrix4(r),l={};u.getPositionToCartographic(s,l),document.getElementById("credits").innerText=W(l.lat,l.lon)+`
`+e.getCreditsString()}
